---
import credentials from '../lib/credentials';

/* Layouts */
import Layout from '../layouts/Layout.astro';

/* Components */
import Header from '../components/Header';
import Images from '../components/Images.astro';

/**
 * Fetch data
 */
const response = await fetch(
  `https://www.flickr.com/services/rest/?method=flickr.photosets.getPhotos&api_key=${credentials.app_key}&photoset_id=${credentials.photoset_id}&user_id=${credentials.user_id}&format=json&nojsoncallback=1`
);

const data: Data = await response.json();

/**
 * Complete data
 */
const photos: Photo[] = data.photoset.photo;

const completeData: CompleteData[] = [];

await Promise.all(
  photos.map(async (photo: Photo) => {
    const response = await fetch(
      `https://www.flickr.com/services/rest/?method=flickr.photos.getInfo&api_key=${credentials.app_key}&photo_id=${photo.id}&format=json&nojsoncallback=1`
    );
    const data: CompleteData = await response.json();
    completeData.push(data);
  })
);
---

<Layout title='FILM-V2'>
  <main>
    <Header />
    <Images data={completeData} />
  </main>
</Layout>
